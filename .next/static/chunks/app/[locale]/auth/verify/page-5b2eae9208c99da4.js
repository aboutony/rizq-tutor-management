(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[376],{9669:function(e,t,r){Promise.resolve().then(r.bind(r,8071))},8071:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return o}});var s=r(7437),a=r(2265),n=r(5153),i=r(6463);function o(){let e=(0,n.T)("auth");(0,n.T)("common");let t=(0,i.useParams)(),r=(0,i.useRouter)(),o=t.locale,[c,l]=(0,a.useState)(Array(6).fill("")),[u,d]=(0,a.useState)(!1),[m,f]=(0,a.useState)(""),[h,x]=(0,a.useState)(0),p=(0,a.useRef)([]),v=sessionStorage.getItem("rizq_auth_phone")||"",y=sessionStorage.getItem("rizq_auth_role")||"TUTOR";(0,a.useEffect)(()=>{var e;null===(e=p.current[0])||void 0===e||e.focus()},[]),(0,a.useEffect)(()=>{if(h<=0)return;let e=setTimeout(()=>x(e=>e-1),1e3);return()=>clearTimeout(e)},[h]);let b=(e,t)=>{if(!/^\d*$/.test(t))return;let r=[...c];if(r[e]=t.slice(-1),l(r),t&&e<5){var s;null===(s=p.current[e+1])||void 0===s||s.focus()}r.every(e=>""!==e)&&6===r.join("").length&&j(r.join(""))},g=(e,t)=>{if("Backspace"===t.key&&!c[e]&&e>0){var r;null===(r=p.current[e-1])||void 0===r||r.focus()}},j=async t=>{d(!0),f("");try{let a=await fetch("/api/auth/otp/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:v,code:t,role:y,locale:o})});if(a.ok)sessionStorage.removeItem("rizq_auth_phone"),sessionStorage.removeItem("rizq_auth_role"),"STUDENT_PARENT"===y?r.replace("/".concat(o,"/dashboard/student")):r.replace("/".concat(o,"/dashboard/tutor"));else{var s;let t=await a.json();401===a.status?f(e("error_invalid_code")):f(t.message||e("error_generic")),l(Array(6).fill("")),null===(s=p.current[0])||void 0===s||s.focus()}}catch(t){f(e("error_generic"))}finally{d(!1)}},N=async()=>{if(!(h>0))try{await fetch("/api/auth/otp/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phone:v,role:y})}),x(30)}catch(t){f(e("error_generic"))}},_=v?v.slice(0,-4).replace(/./g,"•")+v.slice(-4):"";return(0,s.jsx)("main",{className:"min-h-screen bg-rizq-surface flex flex-col items-center justify-center px-4 py-8",children:(0,s.jsxs)("div",{className:"w-full max-w-sm animate-fade-in",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 rounded-2xl bg-rizq-primary/10 flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-rizq-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-rizq-text",children:e("verify_title")}),(0,s.jsxs)("p",{className:"mt-2 text-rizq-text-muted text-sm",children:[e("code_sent_to")," ",_]})]}),(0,s.jsxs)("div",{className:"card space-y-6",children:[(0,s.jsx)("div",{className:"flex justify-center gap-3 dir-ltr",style:{direction:"ltr"},onPaste:e=>{e.preventDefault();let t=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,6);if(6===t.length){var r;l(t.split("")),null===(r=p.current[5])||void 0===r||r.focus(),j(t)}},children:c.map((e,t)=>(0,s.jsx)("input",{ref:e=>{p.current[t]=e},type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:1,value:e,onChange:e=>b(t,e.target.value),onKeyDown:e=>g(t,e),className:"w-12 h-14 text-center text-xl font-bold rounded-xl border-2\n                  transition-all duration-200\n                  bg-rizq-input-bg text-rizq-text\n                  ".concat(e?"border-rizq-primary shadow-lg shadow-rizq-primary/10":"border-rizq-input-border","\n                  focus:outline-none focus:border-rizq-primary focus:shadow-lg focus:shadow-rizq-primary/20"),disabled:u,autoComplete:"one-time-code"},t))}),m&&(0,s.jsx)("div",{className:"bg-rizq-danger/10 border border-rizq-danger/20 text-rizq-danger rounded-xl px-4 py-3 text-sm text-center animate-fade-in",children:m}),(0,s.jsx)("button",{onClick:()=>j(c.join("")),disabled:u||c.some(e=>!e),className:"btn-primary w-full disabled:opacity-50 disabled:cursor-not-allowed",children:u?(0,s.jsxs)("span",{className:"flex items-center justify-center gap-2",children:[(0,s.jsxs)("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",className:"opacity-25"}),(0,s.jsx)("path",{fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",className:"opacity-75"})]}),e("verifying")]}):e("verify_button")}),(0,s.jsx)("div",{className:"text-center",children:(0,s.jsxs)("p",{className:"text-sm text-rizq-text-muted",children:[e("didnt_receive")," ",(0,s.jsx)("button",{onClick:N,disabled:h>0,className:"text-rizq-primary font-semibold hover:underline disabled:opacity-50 disabled:cursor-not-allowed",children:h>0?"".concat(e("resend")," (").concat(h,"s)"):e("resend")})]})})]}),(0,s.jsx)("div",{className:"mt-6 text-center",children:(0,s.jsxs)("a",{href:"/".concat(o,"/auth/login"),className:"text-sm text-rizq-text-muted hover:text-rizq-text transition-colors",children:["← ",e("back_to_login")]})})]})})}},6463:function(e,t,r){"use strict";var s=r(1169);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},5153:function(e,t,r){"use strict";r.d(t,{T:function(){return n}});var s=r(2756);function a(e,t){return(...e)=>{try{return t(...e)}catch{throw Error(void 0)}}}let n=a(0,s.T_);a(0,s.Gb)}},function(e){e.O(0,[756,971,23,744],function(){return e(e.s=9669)}),_N_E=e.O()}]);