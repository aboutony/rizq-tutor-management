(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[78],{4820:function(t,e,a){Promise.resolve().then(a.bind(a,4402))},4402:function(t,e,a){"use strict";a.d(e,{DashboardGuardWrapper:function(){return s}});var n=a(7437),r=a(2265),o=a(6463);function c(t){let{role:e,locale:a,children:c}=t,s=(0,o.usePathname)(),u=(0,o.useRouter)(),i=(0,r.useRef)(s),l="TUTOR"===e?"/".concat(a,"/dashboard/tutor"):"/".concat(a,"/dashboard/student"),d="TUTOR"===e?"/".concat(a,"/dashboard/student"):"/".concat(a,"/dashboard/tutor"),h=["/".concat(a,"/auth/verify"),"/".concat(a,"/auth/login")],f=(0,r.useCallback)(t=>!!(t.startsWith(d)||"STUDENT_PARENT"===e&&t.startsWith("/tutor")||h.some(e=>t.startsWith(e))),[d,e,h]),w=(0,r.useCallback)(async()=>{try{let t=await fetch("/api/auth/session",{cache:"no-store",credentials:"same-origin"});if(!t.ok)return u.replace("/".concat(a,"/auth/login")),!1;let n=await t.json();if(!n.authenticated)return u.replace("/".concat(a,"/auth/login")),!1;if(n.role!==e){console.warn("[RIZQ GUARD] Role mismatch: expected ".concat(e,", got ").concat(n.role,". Redirecting."));let t="TUTOR"===n.role?"/".concat(a,"/dashboard/tutor"):"/".concat(a,"/dashboard/student");return u.replace(t),!1}return!0}catch(t){return console.error("[RIZQ GUARD] Session validation failed (network error)"),!0}},[a,e,u]);return(0,r.useEffect)(()=>{let t=()=>{let t=window.location.pathname;f(t)&&(console.warn('[RIZQ GUARD] Back-button violation: "'.concat(t,'" is outside ').concat(e," boundary. Purging history.")),window.history.replaceState(null,"",l),u.replace(l))};return window.addEventListener("popstate",t),()=>window.removeEventListener("popstate",t)},[l,f,e,u]),(0,r.useEffect)(()=>{if(f(s)){console.warn('[RIZQ GUARD] Navigation violation: "'.concat(s,'" blocked for ').concat(e)),window.history.replaceState(null,"",l),u.replace(l);return}s!==i.current&&(i.current=s,w())},[s,f,l,e,u,w]),(0,r.useEffect)(()=>{let t=window.location.pathname;f(t)?(window.history.replaceState({rizqGuard:!0,role:e},"",l),u.replace(l)):window.history.replaceState({rizqGuard:!0,role:e},"",t)},[]),(0,n.jsx)(n.Fragment,{children:c})}function s(t){let{role:e,locale:a,children:r}=t;return(0,n.jsx)(c,{role:e,locale:a,children:r})}},6463:function(t,e,a){"use strict";var n=a(1169);a.o(n,"useParams")&&a.d(e,{useParams:function(){return n.useParams}}),a.o(n,"usePathname")&&a.d(e,{usePathname:function(){return n.usePathname}}),a.o(n,"useRouter")&&a.d(e,{useRouter:function(){return n.useRouter}})}},function(t){t.O(0,[971,23,744],function(){return t(t.s=4820)}),_N_E=t.O()}]);